<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WareRepair Invoice Generator</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script type="text/javascript">
        (function() {
            emailjs.init("W1mPmyvwhu73vtMon");
        })();
    </script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const FileText = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
            </svg>
        );

        const Plus = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const ChevronDown = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="6 9 12 15 18 9"/>
            </svg>
        );

        const Send = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="22" y1="2" x2="11" y2="13"/>
                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
        );

        function WareRepairInvoice() {
            const [docType, setDocType] = useState('estimate');
            const [laborRate, setLaborRate] = useState('100');
            const [customerEmail, setCustomerEmail] = useState('');
            const [customerName, setCustomerName] = useState('');
            const [sending, setSending] = useState(false);
            
            const [jobs, setJobs] = useState([{
                id: 1,
                name: '',
                partsMarkup: '',
                laborHours: '',
                expanded: false,
                parts: [{ id: 1, name: '', quantity: '', price: '' }]
            }]);

            const addJob = () => {
                setJobs([...jobs, {
                    id: Date.now(),
                    name: '',
                    partsMarkup: '',
                    laborHours: '',
                    expanded: false,
                    parts: [{ id: Date.now(), name: '', quantity: '', price: '' }]
                }]);
            };

            const updateJob = (id, field, value) => {
                setJobs(jobs.map(j => j.id === id ? { ...j, [field]: value } : j));
            };

            const toggleExpanded = (id) => {
                setJobs(jobs.map(j => j.id === id ? { ...j, expanded: !j.expanded } : j));
            };

            const addPart = (jobId) => {
                setJobs(jobs.map(j => {
                    if (j.id === jobId) {
                        return {
                            ...j,
                            parts: [...j.parts, { id: Date.now(), name: '', quantity: '', price: '' }]
                        };
                    }
                    return j;
                }));
            };

            const updatePart = (jobId, partId, field, value) => {
                setJobs(jobs.map(j => {
                    if (j.id === jobId) {
                        return {
                            ...j,
                            parts: j.parts.map(p => p.id === partId ? { ...p, [field]: value } : p)
                        };
                    }
                    return j;
                }));
            };

            // Calculate totals
            const rate = parseFloat(laborRate) || 0;
            
            const jobTotals = jobs.map(job => {
                const hours = parseFloat(job.laborHours) || 0;
                const laborCost = hours * rate;
                
                const partsCost = job.parts.reduce((sum, part) => {
                    const qty = parseFloat(part.quantity) || 0;
                    const price = parseFloat(part.price) || 0;
                    return sum + (qty * price);
                }, 0);
                
                const markup = parseFloat(job.partsMarkup) || 0;
                const markedUpParts = partsCost * (1 + markup / 100);
                
                return {
                    labor: laborCost,
                    parts: markedUpParts,
                    total: laborCost + markedUpParts
                };
            });

            const grandTotal = jobTotals.reduce((sum, jt) => sum + jt.total, 0);

            const sendEstimate = () => {
                if (!customerEmail || !customerName) {
                    alert('Please enter customer name and email');
                    return;
                }

                setSending(true);

                // Build invoice details
                let invoiceDetails = `${docType.toUpperCase()}\n\n`;
                invoiceDetails += `Labor Rate: ${laborRate}/hour\n\n`;
                
                jobs.forEach((job, index) => {
                    if (job.name) {
                        invoiceDetails += `JOB ${index + 1}: ${job.name}\n`;
                        invoiceDetails += `Labor: ${job.laborHours || 0} hours @ ${laborRate}/hr = ${jobTotals[index].labor.toFixed(2)}\n`;
                        
                        if (job.parts.some(p => p.name)) {
                            invoiceDetails += `Parts (${job.partsMarkup || 0}% markup):\n`;
                            job.parts.forEach(part => {
                                if (part.name) {
                                    const partTotal = (parseFloat(part.quantity) || 0) * (parseFloat(part.price) || 0);
                                    invoiceDetails += `  - ${part.name}: ${part.quantity || 0} x ${part.price || 0} = ${partTotal.toFixed(2)}\n`;
                                }
                            });
                        }
                        
                        invoiceDetails += `Job Total: ${jobTotals[index].total.toFixed(2)}\n\n`;
                    }
                });
                
                invoiceDetails += `GRAND TOTAL: ${grandTotal.toFixed(2)}`;

                const templateParams = {
                    to_name: customerName,
                    to_email: customerEmail,
                    from_name: "WareRepair",
                    document_type: docType.toUpperCase(),
                    invoice_details: invoiceDetails,
                    total_amount: `${grandTotal.toFixed(2)}`
                };

                emailjs.send('service_jnyzbk8', 'template_h4qtpme', templateParams)
                    .then(() => {
                        alert(`${docType === 'estimate' ? 'Estimate' : 'Invoice'} sent successfully to ${customerEmail}!`);
                        setSending(false);
                    })
                    .catch((error) => {
                        alert('Failed to send. Error: ' + error.text);
                        setSending(false);
                    });
            };

            return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6" },
                React.createElement('div', { className: "max-w-4xl mx-auto" },
                    React.createElement('div', { className: "bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl p-8 border border-white/20" },
                        // Header
                        React.createElement('div', { className: "flex items-center gap-3 mb-8" },
                            React.createElement('div', { className: "bg-gradient-to-br from-cyan-400 to-blue-500 p-3 rounded-xl" },
                                React.createElement(FileText, { size: 32 })
                            ),
                            React.createElement('div', { className: "flex-1" },
                                React.createElement('h1', { className: "text-3xl font-bold text-white" }, "WareRepair"),
                                React.createElement('p', { className: "text-cyan-300 text-sm" }, "Professional estimates & invoices")
                            )
                        ),

                        React.createElement('div', { className: "space-y-6" },
                            // Customer Info
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-cyan-300 text-sm font-semibold mb-2" }, "Customer Name"),
                                    React.createElement('input', {
                                        type: "text",
                                        value: customerName,
                                        onChange: (e) => setCustomerName(e.target.value),
                                        placeholder: "John Doe",
                                        className: "w-full bg-white/5 border-2 border-cyan-500/30 rounded-xl p-4 text-white placeholder-white/40 focus:border-cyan-400 focus:outline-none transition-all"
                                    })
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-cyan-300 text-sm font-semibold mb-2" }, "Customer Email"),
                                    React.createElement('input', {
                                        type: "email",
                                        value: customerEmail,
                                        onChange: (e) => setCustomerEmail(e.target.value),
                                        placeholder: "customer@email.com",
                                        className: "w-full bg-white/5 border-2 border-cyan-500/30 rounded-xl p-4 text-white placeholder-white/40 focus:border-cyan-400 focus:outline-none transition-all"
                                    })
                                )
                            ),

                            // Document Type & Labor Rate
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-cyan-300 text-sm font-semibold mb-2" }, "Document Type"),
                                    React.createElement('select', {
                                        value: docType,
                                        onChange: (e) => setDocType(e.target.value),
                                        className: "w-full bg-white/5 border-2 border-cyan-500/30 rounded-xl p-4 text-white focus:border-cyan-400 focus:outline-none transition-all"
                                    },
                                        React.createElement('option', { value: 'estimate' }, "Estimate"),
                                        React.createElement('option', { value: 'invoice' }, "Invoice")
                                    )
                                ),
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-cyan-300 text-sm font-semibold mb-2" }, "Labor Rate ($/hour)"),
                                    React.createElement('input', {
                                        type: "number",
                                        step: "0.01",
                                        value: laborRate,
                                        onChange: (e) => setLaborRate(e.target.value),
                                        placeholder: "100",
                                        className: "w-full bg-white/5 border-2 border-cyan-500/30 rounded-xl p-4 text-white placeholder-white/40 focus:border-cyan-400 focus:outline-none transition-all"
                                    })
                                )
                            ),

                            // Jobs Section
                            React.createElement('div', { className: "bg-purple-500/10 border-2 border-purple-400/30 rounded-xl p-5 space-y-4" },
                                React.createElement('h3', { className: "text-purple-300 font-semibold text-lg" }, "Jobs"),
                                
                                jobs.map((job, index) => 
                                    React.createElement('div', { key: job.id, className: "bg-white/5 rounded-lg p-4 space-y-3" },
                                        React.createElement('div', { className: "grid grid-cols-12 gap-3" },
                                            React.createElement('input', {
                                                type: "text",
                                                value: job.name,
                                                onChange: (e) => updateJob(job.id, 'name', e.target.value),
                                                placeholder: "Job name",
                                                className: "col-span-5 bg-white/5 border-2 border-purple-500/30 rounded-lg p-2 text-white placeholder-white/40 focus:border-purple-400 focus:outline-none"
                                            }),
                                            React.createElement('input', {
                                                type: "number",
                                                step: "0.1",
                                                value: job.laborHours,
                                                onChange: (e) => updateJob(job.id, 'laborHours', e.target.value),
                                                placeholder: "Hours",
                                                className: "col-span-2 bg-white/5 border-2 border-purple-500/30 rounded-lg p-2 text-white placeholder-white/40 focus:border-purple-400 focus:outline-none"
                                            }),
                                            React.createElement('input', {
                                                type: "number",
                                                step: "0.1",
                                                value: job.partsMarkup,
                                                onChange: (e) => updateJob(job.id, 'partsMarkup', e.target.value),
                                                placeholder: "Markup %",
                                                className: "col-span-3 bg-white/5 border-2 border-purple-500/30 rounded-lg p-2 text-white placeholder-white/40 focus:border-purple-400 focus:outline-none"
                                            }),
                                            React.createElement('button', {
                                                onClick: () => toggleExpanded(job.id),
                                                className: "col-span-2 bg-purple-500/20 hover:bg-purple-500/30 rounded-lg p-2 transition-all flex items-center justify-center"
                                            }, React.createElement(ChevronDown, { size: 20 }))
                                        ),
                                        
                                        job.expanded && React.createElement('div', { className: "space-y-2 pl-4 border-l-2 border-purple-500/30" },
                                            React.createElement('div', { className: "text-purple-200 text-sm font-semibold mb-2" }, "Parts"),
                                            job.parts.map(part =>
                                                React.createElement('div', { key: part.id, className: "grid grid-cols-12 gap-2" },
                                                    React.createElement('input', {
                                                        type: "text",
                                                        value: part.name,
                                                        onChange: (e) => updatePart(job.id, part.id, 'name', e.target.value),
                                                        placeholder: "Part name",
                                                        className: "col-span-6 bg-white/5 border border-purple-500/30 rounded p-2 text-white text-sm placeholder-white/40 focus:border-purple-400 focus:outline-none"
                                                    }),
                                                    React.createElement('input', {
                                                        type: "number",
                                                        step: "0.01",
                                                        value: part.quantity,
                                                        onChange: (e) => updatePart(job.id, part.id, 'quantity', e.target.value),
                                                        placeholder: "Qty",
                                                        className: "col-span-2 bg-white/5 border border-purple-500/30 rounded p-2 text-white text-sm placeholder-white/40 focus:border-purple-400 focus:outline-none"
                                                    }),
                                                    React.createElement('input', {
                                                        type: "number",
                                                        step: "0.01",
                                                        value: part.price,
                                                        onChange: (e) => updatePart(job.id, part.id, 'price', e.target.value),
                                                        placeholder: "Price",
                                                        className: "col-span-4 bg-white/5 border border-purple-500/30 rounded p-2 text-white text-sm placeholder-white/40 focus:border-purple-400 focus:outline-none"
                                                    })
                                                )
                                            ),
                                            React.createElement('button', {
                                                onClick: () => addPart(job.id),
                                                className: "text-purple-300 text-sm hover:text-purple-200 flex items-center gap-1"
                                            },
                                                React.createElement(Plus, { size: 16 }),
                                                "Add Part"
                                            )
                                        ),

                                        React.createElement('div', { className: "flex justify-between items-center pt-2 border-t border-purple-500/30" },
                                            React.createElement('span', { className: "text-purple-200 text-sm" }, `Job ${index + 1} Total:`),
                                            React.createElement('span', { className: "text-white font-bold text-lg" }, `$${jobTotals[index]?.total.toFixed(2) || '0.00'}`)
                                        )
                                    )
                                ),
                                
                                React.createElement('button', {
                                    onClick: addJob,
                                    className: "w-full bg-purple-500/20 hover:bg-purple-500/30 text-purple-200 font-semibold py-3 rounded-lg transition-all flex items-center justify-center gap-2"
                                },
                                    React.createElement(Plus, { size: 20 }),
                                    "Add Another Job"
                                )
                            ),

                            // Grand Total
                            React.createElement('div', { className: "bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-2xl p-6 border-2 border-green-400/50" },
                                React.createElement('div', { className: "flex justify-between items-center" },
                                    React.createElement('div', null,
                                        React.createElement('div', { className: "text-green-200 text-sm" }, docType === 'estimate' ? 'ESTIMATED TOTAL' : 'INVOICE TOTAL'),
                                        React.createElement('div', { className: "text-white font-bold text-4xl" }, `$${grandTotal.toFixed(2)}`)
                                    ),
                                    React.createElement(FileText, { size: 48 })
                                )
                            ),

                            // Send Button
                            React.createElement('button', {
                                onClick: sendEstimate,
                                disabled: sending,
                                className: `w-full bg-gradient-to-r from-cyan-500 via-blue-500 to-purple-500 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-cyan-500/50 transition-all flex items-center justify-center gap-2 text-lg ${sending ? 'opacity-50 cursor-not-allowed' : ''}`
                            },
                                React.createElement(Send, { size: 24 }),
                                sending ? 'Sending...' : `Send ${docType === 'estimate' ? 'Estimate' : 'Invoice'}`
                            )
                        )
                    )
                )
            );
        }

        ReactDOM.render(React.createElement(WareRepairInvoice), document.getElementById('root'));
    </script>
</body>
</html>